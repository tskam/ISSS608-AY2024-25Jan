<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Dr.&nbsp;Kam Tin Seong Assoc. Professor of Information Systems">
  <meta name="dcterms.date" content="2025-02-08">
  <title>ISSS608 – Building Web-enabled Visual Analytics Application with Shiny: Beyond the basic</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Building Web-enabled Visual Analytics Application with Shiny: Beyond the basic</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dr.&nbsp;Kam Tin Seong<br>Assoc. Professor of Information Systems 
</div>
        <p class="quarto-title-affiliation">
            School of Computing and Information Systems,<br>Singapore Management University
          </p>
    </div>
</div>

  <p class="date">08 Feb 2025</p>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<p>In this lesson, selected advanced methods of Shiny will be discussed. You will also gain hands-on experiences on using these advanced methods to build Shiny applications.</p>
<p>By the end of this lesson, you will be able to:</p>
<ul>
<li>gain further understanding of the reactive feature of Shiny and Shiny’s functions that support reactive flow,</li>
<li>build interactive Shiny application by using plotly R and</li>
<li>build static, interactive and reactive geovisualisation application by using tmap</li>
</ul>
</section>
<section id="reactive-flow" class="slide level2">
<h2>Reactive Flow</h2>
<p>By default, Shiny application is <strong>Reactive</strong>!</p>

<img data-src="img/image12.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="reactive-flow---the-basic">Reactive Flow - the basic</h3>
<p>The user selects an input, this input goes through some expression in the server, and an output is rendered. Each time the user changes their input selection, the expression that generates the output will automatically re-execute, and the relevant output will be re-rendered based on the new value of the input.</p>
<p>In a Shiny application, there’s no need to explictly describe the relationships between inputs and outputs and tell R what to do when each input changes, Shiny automatically handles these details for you.</p>

<img data-src="img/image11.jpg" class="r-stretch"><div style="font-size: 0.75em">
<p>Source: <a href="https://minecr.shinyapps.io/02-flow/#section-reactive-flow">Module 2</a> of <a href="https://rstudio-education.github.io/shiny-course/">Building Web Applications with Shiny</a></p>
</div>
</section>
<section class="slide level2">

<h3 id="reactive-flow---the-full-features">Reactive Flow - The full features</h3>

<img data-src="img/image1.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="reactive-elements">Reactive elements</h3>
<div class="columns">
<div class="column" style="width:60%;">
<p>Three components of reactive execution in Shiny are:</p>
<ul>
<li>reactive inputs,</li>
<li>reactive expressions, and</li>
<li>reactive outputs.</li>
</ul>
<p><img data-src="img/image13.jpg"></p>
</div></div>
</section>
<section class="slide level2">

<h3 id="reactive-elements-1">Reactive elements</h3>
<div style="font-size: 0.85em">
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="reactive-inputs-and-outputs">Reactive inputs and outputs</h4>
<ul>
<li>A <strong>reactive input</strong> is a user input that comes through a browser interface, typically.</li>
<li>A <strong>reactive output</strong> is something that appears in the user’s browser window, such as a plot or a table of values.</li>
</ul>
<p><img data-src="img/image14.jpg"></p>
<ul>
<li>One reactive input can be connected to multiple outputs, and vice versa. For example we might have a UI input widget for filtering out data based on user’s selection, and the filtered data can be used in multiple outputs like plots and summaries.</li>
</ul>
</div><div class="column" style="width:50%;">
<h4 id="reactive-expressions">Reactive expressions</h4>
<ul>
<li><p>A <strong>reactive expressions</strong> is component between an input and an output.</p></li>
<li><p>It can both be a dependent (i.e be a child) and have dependents (i.e.&nbsp;be a parent).</p></li>
</ul>
<p><img data-src="img/image15.jpg"></p>
</div></div>
</div>
</section>
<section id="in-class-exercise-building-a-reactive-scatter-plot-using-shiny" class="slide level2">
<h2>In-class Exercise: Building a reactive scatter plot using Shiny</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In this in-class exercise, you are going to explore advanced reactive features.</p>
<p>To get started, you need to do the followings:</p>
<ul>
<li>start a new Shiny Application</li>
<li>load the necessary R package, namely Shiny and tidyverse</li>
<li>import the data file (i.e.&nbsp;Exam_data.csv )</li>
<li>build a basic scatterplot look similar to the figure on the right.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="img/image16.jpg"></p>
</div></div>
</section>
<section class="slide level2">

<h3 id="the-ui">The UI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a></a>exam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Exam_data.csv"</span>)</span>
<span id="cb1-4"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb1-5"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Subject Correlation Analysis"</span>),</span>
<span id="cb1-6"><a></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb1-7"><a></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb1-8"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"yvariable"</span>,</span>
<span id="cb1-9"><a></a>                        <span class="at">label =</span> <span class="st">"y Variable:"</span>,</span>
<span id="cb1-10"><a></a>                        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"English"</span> <span class="ot">=</span> <span class="st">"ENGLISH"</span>,</span>
<span id="cb1-11"><a></a>                                    <span class="st">"Maths"</span> <span class="ot">=</span> <span class="st">"MATHS"</span>,</span>
<span id="cb1-12"><a></a>                                    <span class="st">"Science"</span> <span class="ot">=</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb1-13"><a></a>                        <span class="at">selected =</span> <span class="st">"MATHS"</span>),</span>
<span id="cb1-14"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"xvariable"</span>,</span>
<span id="cb1-15"><a></a>                        <span class="at">label =</span> <span class="st">"x Variable:"</span>,</span>
<span id="cb1-16"><a></a>                        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"English"</span> <span class="ot">=</span> <span class="st">"ENGLISH"</span>,</span>
<span id="cb1-17"><a></a>                                    <span class="st">"Maths"</span> <span class="ot">=</span> <span class="st">"MATHS"</span>,</span>
<span id="cb1-18"><a></a>                                    <span class="st">"Science"</span> <span class="ot">=</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb1-19"><a></a>                        <span class="at">selected =</span> <span class="st">"SCIENCE"</span>)</span>
<span id="cb1-20"><a></a>        ),</span>
<span id="cb1-21"><a></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb1-22"><a></a>            <span class="fu">plotOutput</span>(<span class="st">"scatterPlot"</span>)</span>
<span id="cb1-23"><a></a>        )</span>
<span id="cb1-24"><a></a>    )</span>
<span id="cb1-25"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="the-server">The server</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session){    </span>
<span id="cb2-2"><a></a>    output<span class="sc">$</span>scatterPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb2-3"><a></a>        <span class="fu">ggplot</span>(<span class="at">data=</span>exam,</span>
<span id="cb2-4"><a></a>               <span class="fu">aes_string</span>(<span class="at">x =</span> input<span class="sc">$</span>xvariable,      </span>
<span id="cb2-5"><a></a>                          <span class="at">y =</span> input<span class="sc">$</span>yvariable)) <span class="sc">+</span>   </span>
<span id="cb2-6"><a></a>                   <span class="fu">geom_point</span>()</span>
<span id="cb2-7"><a></a>    })</span>
<span id="cb2-8"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly, do not forget to add this line!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">shinyApp</span> (<span class="at">ui=</span>ui, <span class="at">server=</span>server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="stop-trigger-delay">Stop-trigger-delay</h3>
<p>In this section, you will learn how to how to stop, trigger, and delay Shiny actions.</p>
<ul>
<li>Using <code>submitButton()</code></li>
<li>Using <code>isolate()</code> and <code>actionButton()</code></li>
</ul>
</section>
<section class="slide level2">

<h3 id="working-with-submitbutton">Working with <code>submitButton()</code></h3>

<img data-src="img/image17.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="working-with-submitbutton-1">Working with <code>submitButton()</code></h3>
<ul>
<li><p><code>submitButton()</code> is used when you want to delay a reaction.</p></li>
<li><p>Edit the code as shown below:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"xvariable"</span>,</span>
<span id="cb4-2"><a></a>                        <span class="at">label =</span> <span class="st">"x Variable:"</span>,</span>
<span id="cb4-3"><a></a>                        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"English"</span> <span class="ot">=</span> <span class="st">"ENGLISH"</span>,</span>
<span id="cb4-4"><a></a>                                    <span class="st">"Maths"</span> <span class="ot">=</span> <span class="st">"MATHS"</span>,</span>
<span id="cb4-5"><a></a>                                    <span class="st">"Science"</span> <span class="ot">=</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb4-6"><a></a>                        <span class="at">selected =</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb4-7"><a></a>            <span class="fu">submitButton</span>(<span class="st">"Apply changes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: The use of <code>submitButton()</code> is generally discouraged in favor of the more versatile <code>actionButton()</code>.</p>
<p>Reference: <a href="https://shiny.rstudio.com/reference/shiny/latest/submitButton.html">submitButton</a>.</p>
</section>
<section class="slide level2">

<h3 id="isolating-reactions">Isolating reactions</h3>
<h4 id="when-to-use">When to use?</h4>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Suppose your app has an input widget where users can enter text for the title of the plot. However you only want the title to update if any of the other inputs that go into the plot change. You can achieve this by isolating the plot title such that:
<ul>
<li>When input<span class="math inline">\(x or input\)</span>y changes, the plot will update.</li>
<li>But when only the title input (input$plot_title) changes, the plot will not update.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="img/image19.jpg"></p>
</div></div>
<p>Reference: <a href="https://shiny.rstudio.com/articles/isolation.html">isolation</a></p>
</section>
<section class="slide level2">

<h3 id="working-with-isolate-and-actionbutton">Working with <code>isolate()</code> and <code>actionButton()</code></h3>
<ul>
<li>At the ui, edit the code as shown below:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="7-11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"xvariable"</span>,</span>
<span id="cb5-2"><a></a>                        <span class="at">label =</span> <span class="st">"x Variable:"</span>,</span>
<span id="cb5-3"><a></a>                        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"English"</span> <span class="ot">=</span> <span class="st">"ENGLISH"</span>,</span>
<span id="cb5-4"><a></a>                                    <span class="st">"Maths"</span> <span class="ot">=</span> <span class="st">"MATHS"</span>,</span>
<span id="cb5-5"><a></a>                                    <span class="st">"Science"</span> <span class="ot">=</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb5-6"><a></a>                        <span class="at">selected =</span> <span class="st">"SCIENCE"</span>),</span>
<span id="cb5-7"><a></a>            <span class="fu">textInput</span>(                       </span>
<span id="cb5-8"><a></a>                <span class="at">inputId =</span> <span class="st">"plot_title"</span>,     </span>
<span id="cb5-9"><a></a>                <span class="at">label =</span> <span class="st">"Plot title"</span>,       </span>
<span id="cb5-10"><a></a>                <span class="at">placeholder =</span> <span class="st">"Enter text to be used as plot title"</span>), </span>
<span id="cb5-11"><a></a>            <span class="fu">actionButton</span>(<span class="st">"goButton"</span>, <span class="st">"Go!"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Reference guide on <a href="https://shiny.rstudio.com/reference/shiny/1.6.0/textInput.html"><code>textInput()</code></a></li>
<li>Reference guide on <a href="https://shiny.rstudio.com/reference/shiny/1.6.0/actionButton.html"><code>actionButton()</code></a></li>
</ul>
</section>
<section class="slide level2">

<h3 id="working-with-isolate-and-actionbutton-1">Working with <code>isolate()</code> and <code>actionButton()</code></h3>
<ul>
<li>At the server side, edit the codes as shown below:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="3,9-11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session){</span>
<span id="cb6-2"><a></a>    output<span class="sc">$</span>scatterPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb6-3"><a></a>        input<span class="sc">$</span>goButton                           </span>
<span id="cb6-4"><a></a>        </span>
<span id="cb6-5"><a></a>        <span class="fu">ggplot</span>(<span class="at">data=</span>exam,</span>
<span id="cb6-6"><a></a>               <span class="fu">aes_string</span>(<span class="at">x =</span> input<span class="sc">$</span>xvariable,</span>
<span id="cb6-7"><a></a>                          <span class="at">y =</span> input<span class="sc">$</span>yvariable)) <span class="sc">+</span></span>
<span id="cb6-8"><a></a>            <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-9"><a></a>            <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">isolate</span>({               </span>
<span id="cb6-10"><a></a>                <span class="fu">toTitleCase</span>(input<span class="sc">$</span>plot_title)    </span>
<span id="cb6-11"><a></a>            }))                                  </span>
<span id="cb6-12"><a></a>    })</span>
<span id="cb6-13"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Reference guide on <a href="https://shiny.rstudio.com/reference/shiny/1.6.0/isolate.html"><code>isolate()</code></a></li>
</ul>
</section>
<section id="embedding-interactive-graphs-in-r-shiny" class="slide level2">
<h2>Embedding Interactive Graphs in R Shiny</h2>
<h3 id="the-plotly-way">The <strong>plotly</strong> way</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>Two approaches: - Using plotly directly, or - Plot the basic visualisation using <strong>ggplot2</strong>, then wrap the visualisation object into plotly object using <code>ggplotly()</code>.</p>
<p>Reference: - <a href="https://plotly.com/r/">Plotly R Open Source Graphing Library</a> - <a href="https://plotly-r.com/linking-views-with-shiny.html">17 Server-side linking with shiny</a> of <a href="https://plotly-r.com/index.html">Interactive web-based data visualization with R, plotly, and shiny</a></p>
</div><div class="column" style="width:50%;">
<p><img data-src="img/image20.jpg"></p>
</div></div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-an-interactive-scatter-plot-in-shiny">In-class Exercise: Embedding an interactive scatter plot in Shiny</h3>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Install plotly R package if it has yet to be install in RStudio.</li>
<li>include a new line as shown below to launch plotly library.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="2,"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb7-2"><a></a><span class="fu">library</span>(plotly) </span>
<span id="cb7-3"><a></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>At UI, edit the code as shown below</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a> <span class="fu">mainPanel</span>(</span>
<span id="cb8-2"><a></a>    <span class="fu">plotlyOutput</span>(<span class="st">"scatterPlot"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>edit the server section of the Shiny app as shown below.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output){</span>
<span id="cb9-2"><a></a>    output<span class="sc">$</span>scatterPlot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({ <span class="co">#&lt;&lt;</span></span>
<span id="cb9-3"><a></a>        </span>
<span id="cb9-4"><a></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> exam, </span>
<span id="cb9-5"><a></a>            <span class="fu">aes_string</span>(<span class="at">x =</span> input<span class="sc">$</span>xvariable,</span>
<span id="cb9-6"><a></a>                       <span class="at">y =</span> input<span class="sc">$</span>yvariable)) <span class="sc">+</span></span>
<span id="cb9-7"><a></a>            <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">"grey 10"</span>, </span>
<span id="cb9-8"><a></a>                       <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb9-9"><a></a>        </span>
<span id="cb9-10"><a></a>            <span class="fu">ggplotly</span>(p) <span class="co">#&lt;&lt;                           </span></span>
<span id="cb9-11"><a></a>    })</span>
<span id="cb9-12"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-an-interactive-bar-chart-in-shiny">In-class Exercise: Embedding an interactive bar chart in Shiny</h3>
<p>In this exercise, you will learn how going to embed an interactive bar chart in Shiny by using plotly. The output will look similar to the figure below.</p>

<img data-src="img/image21.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-an-interactive-bar-chart-in-shiny-1">In-class Exercise: Embedding an interactive bar chart in Shiny</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ui:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb10-2"><a></a><span class="fu">library</span>(plotly)</span>
<span id="cb10-3"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a>exam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Exam_data.csv"</span>)</span>
<span id="cb10-6"><a></a></span>
<span id="cb10-7"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb10-8"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Pupils Profile"</span>),</span>
<span id="cb10-9"><a></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb10-10"><a></a>            <span class="fu">plotlyOutput</span>(<span class="st">"race"</span>),</span>
<span id="cb10-11"><a></a>        )</span>
<span id="cb10-12"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p>The server:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb11-2"><a></a>    output<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb11-3"><a></a>        p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>exam, </span>
<span id="cb11-4"><a></a>                    <span class="fu">aes</span>(<span class="at">x=</span>RACE)) <span class="sc">+</span></span>
<span id="cb11-5"><a></a>            <span class="fu">geom_bar</span>()</span>
<span id="cb11-6"><a></a>        <span class="fu">ggplotly</span>(p)</span>
<span id="cb11-7"><a></a>    })</span>
<span id="cb11-8"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Last but not least the app</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">shinyApp</span> (<span class="at">ui=</span>ui, <span class="at">server=</span>server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="in-class-exercise-embedding-a-drill-down-bar-chart-in-shiny" class="slide level2">
<h2>In-class Exercise: Embedding a drill-down bar chart in Shiny</h2>
<p>In this exercise, you will learn how to embed a drill-down bar chart in Shiny by using <a href="https://search.r-project.org/CRAN/refmans/plotly/html/event_data.html"><code>event_data()</code></a> of plotly.</p>

<img data-src="img/image22.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-a-drill-down-bar-chart-in-shiny-1">In-class Exercise: Embedding a drill-down bar chart in Shiny</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ui:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb13-2"><a></a><span class="fu">library</span>(plotly)</span>
<span id="cb13-3"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-4"><a></a></span>
<span id="cb13-5"><a></a>exam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Exam_data.csv"</span>)</span>
<span id="cb13-6"><a></a></span>
<span id="cb13-7"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb13-8"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Drill-down Bar Chart"</span>),</span>
<span id="cb13-9"><a></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb13-10"><a></a>            <span class="fu">plotlyOutput</span>(<span class="st">"race"</span>),</span>
<span id="cb13-11"><a></a>            <span class="fu">plotlyOutput</span>(<span class="st">"gender"</span>),</span>
<span id="cb13-12"><a></a>            <span class="fu">verbatimTextOutput</span>(<span class="st">"info"</span>)</span>
<span id="cb13-13"><a></a>        )</span>
<span id="cb13-14"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visit this <a href="https://www.marsja.se/how-to-use-in-in-r/">link</a> to learn more about %in%.</p>
</div><div class="column" style="width:50%;">
<p>The server:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb14-2"><a></a>    output<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-3"><a></a>        p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>exam, </span>
<span id="cb14-4"><a></a>                    <span class="fu">aes</span>(<span class="at">x=</span>RACE)) <span class="sc">+</span></span>
<span id="cb14-5"><a></a>            <span class="fu">geom_bar</span>()</span>
<span id="cb14-6"><a></a>        <span class="fu">ggplotly</span>(p)</span>
<span id="cb14-7"><a></a>    })</span>
<span id="cb14-8"><a></a>    output<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-9"><a></a>        d <span class="ot">&lt;-</span> <span class="fu">event_data</span>(<span class="st">"plotly_click"</span>) <span class="co">#&lt;&lt;</span></span>
<span id="cb14-10"><a></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(d)) <span class="fu">return</span>(<span class="cn">NULL</span>) <span class="co">#&lt;&lt;</span></span>
<span id="cb14-11"><a></a>        </span>
<span id="cb14-12"><a></a>        p <span class="ot">&lt;-</span> exam <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a></a>            <span class="fu">filter</span>(RACE <span class="sc">%in%</span> d<span class="sc">$</span>x) <span class="sc">%&gt;%</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb14-14"><a></a>            <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>GENDER)) <span class="sc">+</span></span>
<span id="cb14-15"><a></a>            <span class="fu">geom_bar</span>() </span>
<span id="cb14-16"><a></a>        <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a></a>            <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> d<span class="sc">$</span>x)) <span class="co">#&lt;&lt;</span></span>
<span id="cb14-18"><a></a>    })</span>
<span id="cb14-19"><a></a>    output<span class="sc">$</span>info <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb14-20"><a></a>        <span class="fu">event_data</span>(<span class="st">"plotly_click"</span>) <span class="co">#&lt;&lt;</span></span>
<span id="cb14-21"><a></a>    })    </span>
<span id="cb14-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-a-drill-down-bar-chart-in-shiny-revised-version">In-class Exercise: Embedding a drill-down bar chart in Shiny (Revised version)</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ui:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb15-2"><a></a><span class="fu">library</span>(plotly)</span>
<span id="cb15-3"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-4"><a></a></span>
<span id="cb15-5"><a></a>exam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Exam_data.csv"</span>)</span>
<span id="cb15-6"><a></a></span>
<span id="cb15-7"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb15-8"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Drill-down Bar Chart"</span>),</span>
<span id="cb15-9"><a></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb15-10"><a></a>            <span class="fu">plotlyOutput</span>(<span class="st">"race"</span>),</span>
<span id="cb15-11"><a></a>            <span class="fu">plotlyOutput</span>(<span class="st">"gender"</span>),</span>
<span id="cb15-12"><a></a>            <span class="fu">verbatimTextOutput</span>(<span class="st">"info"</span>)</span>
<span id="cb15-13"><a></a>        )</span>
<span id="cb15-14"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p>The server:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb16-2"><a></a>    output<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-3"><a></a>        p <span class="ot">&lt;-</span> exam <span class="sc">%&gt;%</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb16-4"><a></a>            <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span>RACE) <span class="co">#&lt;&lt;</span></span>
<span id="cb16-5"><a></a>    })</span>
<span id="cb16-6"><a></a></span>
<span id="cb16-7"><a></a>    output<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-8"><a></a>        d <span class="ot">&lt;-</span> <span class="fu">event_data</span>(<span class="st">"plotly_click"</span>)</span>
<span id="cb16-9"><a></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(d)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb16-10"><a></a>        </span>
<span id="cb16-11"><a></a>        p <span class="ot">&lt;-</span> exam <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a></a>            <span class="fu">filter</span>(RACE <span class="sc">%in%</span> d<span class="sc">$</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb16-13"><a></a>            <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>GENDER)) <span class="sc">+</span></span>
<span id="cb16-14"><a></a>            <span class="fu">geom_bar</span>() </span>
<span id="cb16-15"><a></a>        <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a></a>            <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> d<span class="sc">$</span>x))</span>
<span id="cb16-17"><a></a>    })</span>
<span id="cb16-18"><a></a></span>
<span id="cb16-19"><a></a>    output<span class="sc">$</span>info <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb16-20"><a></a>        <span class="fu">event_data</span>(<span class="st">"plotly_click"</span>)</span>
<span id="cb16-21"><a></a>    })    </span>
<span id="cb16-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="in-class-exercise-embedding-a-static-map-in-shiny" class="slide level2">
<h2>In-class Exercise: Embedding A Static Map in Shiny</h2>
<p>In this exercise, you will learn how to embed a static map in Shiny by using <em>renderPlot()</em>. By the end of this exercise, you will be able to plot a static map on Shiny display as shown below.</p>

<img data-src="img/image23.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-a-static-map-in-shiny-1">In-class Exercise: Embedding A Static Map in Shiny</h3>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="setting-up">Setting up</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb17-2"><a></a><span class="fu">library</span>(sf)</span>
<span id="cb17-3"><a></a><span class="fu">library</span>(tmap)</span>
<span id="cb17-4"><a></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<h4 id="importing-the-geospatial-data">Importing the geospatial data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb18-2"><a></a>                <span class="at">layer =</span> <span class="st">"MP14_SUBZONE_WEB_PL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-a-static-map-in-shiny-2">In-class Exercise: Embedding a static map in Shiny</h3>
<p>The UI codes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb19-2"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"A simple map display"</span>),</span>
<span id="cb19-3"><a></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb19-4"><a></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb19-5"><a></a>            <span class="fu">checkboxInput</span>(<span class="at">inputId =</span> <span class="st">"show_data"</span>,</span>
<span id="cb19-6"><a></a>                          <span class="at">label =</span> <span class="st">"Show data table"</span>,</span>
<span id="cb19-7"><a></a>                          <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-8"><a></a>        ),</span>
<span id="cb19-9"><a></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb19-10"><a></a>            <span class="fu">plotOutput</span>(<span class="st">"mapPlot"</span>),</span>
<span id="cb19-11"><a></a>            DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="at">outputId =</span> <span class="st">"szTable"</span>)</span>
<span id="cb19-12"><a></a>        )</span>
<span id="cb19-13"><a></a>    )</span>
<span id="cb19-14"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-embedding-a-static-map-in-shiny-3">In-class Exercise: Embedding a static map in Shiny</h3>
<p>The Server codes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output){</span>
<span id="cb20-2"><a></a>    output<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb20-3"><a></a>        <span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb20-4"><a></a>            <span class="fu">tm_fill</span>() <span class="sc">+</span></span>
<span id="cb20-5"><a></a>            <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">0.1</span>,  <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb20-6"><a></a>    })</span>
<span id="cb20-7"><a></a>    </span>
<span id="cb20-8"><a></a>    output<span class="sc">$</span>szTable <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb20-9"><a></a>        <span class="cf">if</span>(input<span class="sc">$</span>show_data){</span>
<span id="cb20-10"><a></a>            DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">data =</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb20-11"><a></a>                          <span class="at">options=</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb20-12"><a></a>                          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-13"><a></a>        }</span>
<span id="cb20-14"><a></a>    })    </span>
<span id="cb20-15"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Important, don’t miss out this line</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">shinyApp</span> (<span class="at">ui=</span>ui, <span class="at">server=</span>server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="in-class-exercise-building-a-choropleth-mapping-application" class="slide level2">
<h2>In-class Exercise: Building a choropleth mapping application</h2>
<p>In this exercise, you will learn how to build a choropleth mapping application by using tmap and Shiny.</p>

<img data-src="img/image24.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="in-class-exercise-building-a-choropleth-mapping-application-1">In-class Exercise: Building a choropleth mapping application</h3>
<p>Edit the code as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb22-2"><a></a><span class="fu">library</span>(sf)</span>
<span id="cb22-3"><a></a><span class="fu">library</span>(tmap)</span>
<span id="cb22-4"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb22-5"><a></a></span>
<span id="cb22-6"><a></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb22-7"><a></a>                <span class="at">layer =</span> <span class="st">"MP14_SUBZONE_WEB_PL"</span>)</span>
<span id="cb22-8"><a></a></span>
<span id="cb22-9"><a></a>popagsex <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/respopagsex2000to2018.csv"</span>) <span class="co">#&lt;&lt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-building-a-choropleth-mapping-application-2">In-class Exercise: Building a choropleth mapping application</h3>
<p>Edit the codes as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>popagsex2018_male <span class="ot">&lt;-</span> popagsex <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a></a>    <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"Males"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a></a>    <span class="fu">filter</span>(Time <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a></a>    <span class="fu">spread</span>(AG, Pop) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a></a>    <span class="fu">mutate</span>(<span class="at">YOUNG =</span> <span class="st">`</span><span class="at">0_to_4</span><span class="st">`</span><span class="sc">+</span><span class="st">`</span><span class="at">5_to_9</span><span class="st">`</span><span class="sc">+</span><span class="st">`</span><span class="at">10_to_14</span><span class="st">`</span><span class="sc">+</span></span>
<span id="cb23-6"><a></a>               <span class="st">`</span><span class="at">15_to_19</span><span class="st">`</span><span class="sc">+</span><span class="st">`</span><span class="at">20_to_24</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">ECONOMY ACTIVE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rowSums</span>(.[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>])<span class="sc">+</span></span>
<span id="cb23-8"><a></a>               <span class="fu">rowSums</span>(.[<span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>]))<span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">AGED</span><span class="st">`</span><span class="ot">=</span><span class="fu">rowSums</span>(.[<span class="dv">18</span><span class="sc">:</span><span class="dv">22</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">TOTAL</span><span class="st">`</span><span class="ot">=</span><span class="fu">rowSums</span>(.[<span class="dv">5</span><span class="sc">:</span><span class="dv">22</span>])) <span class="sc">%&gt;%</span>  </span>
<span id="cb23-11"><a></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">DEPENDENCY</span><span class="st">`</span> <span class="ot">=</span> (<span class="st">`</span><span class="at">YOUNG</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">AGED</span><span class="st">`</span>)</span>
<span id="cb23-12"><a></a>           <span class="sc">/</span><span class="st">`</span><span class="at">ECONOMY ACTIVE</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a></a>    <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="fu">vars</span>(PA, SZ), </span>
<span id="cb23-14"><a></a>              <span class="at">.funs =</span> <span class="fu">funs</span>(toupper)) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">PA</span><span class="st">`</span>, <span class="st">`</span><span class="at">SZ</span><span class="st">`</span>, <span class="st">`</span><span class="at">YOUNG</span><span class="st">`</span>, </span>
<span id="cb23-16"><a></a>           <span class="st">`</span><span class="at">ECONOMY ACTIVE</span><span class="st">`</span>, <span class="st">`</span><span class="at">AGED</span><span class="st">`</span>, </span>
<span id="cb23-17"><a></a>           <span class="st">`</span><span class="at">TOTAL</span><span class="st">`</span>, <span class="st">`</span><span class="at">DEPENDENCY</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">ECONOMY ACTIVE</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb23-19"><a></a>mpsz_agemale2018 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mpsz,</span>
<span id="cb23-20"><a></a>                              popagsex2018_male,</span>
<span id="cb23-21"><a></a>                              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"SUBZONE_N"</span> <span class="ot">=</span> <span class="st">"SZ"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-building-a-choropleth-mapping-application-3">In-class Exercise: Building a choropleth mapping application</h3>
<p>At the UI, edit the codes as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb24-2"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Choropleth Mapping"</span>),</span>
<span id="cb24-3"><a></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb24-4"><a></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb24-5"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"classification"</span>,</span>
<span id="cb24-6"><a></a>                        <span class="at">label =</span> <span class="st">"Classification method:"</span>,</span>
<span id="cb24-7"><a></a>                        <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">"fixed"</span> <span class="ot">=</span> <span class="st">"fixed"</span>, </span>
<span id="cb24-8"><a></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> <span class="st">"sd"</span>, </span>
<span id="cb24-9"><a></a>                                       <span class="st">"equal"</span> <span class="ot">=</span> <span class="st">"equal"</span>, </span>
<span id="cb24-10"><a></a>                                       <span class="st">"pretty"</span> <span class="ot">=</span> <span class="st">"pretty"</span>, </span>
<span id="cb24-11"><a></a>                                       <span class="st">"quantile"</span> <span class="ot">=</span> <span class="st">"quantile"</span>, </span>
<span id="cb24-12"><a></a>                                       <span class="st">"kmeans"</span> <span class="ot">=</span> <span class="st">"kmeans"</span>, </span>
<span id="cb24-13"><a></a>                                       <span class="st">"hclust"</span> <span class="ot">=</span> <span class="st">"hclust"</span>, </span>
<span id="cb24-14"><a></a>                                       <span class="st">"bclust"</span> <span class="ot">=</span> <span class="st">"bclust"</span>, </span>
<span id="cb24-15"><a></a>                                       <span class="st">"fisher"</span> <span class="ot">=</span> <span class="st">"fisher"</span>, </span>
<span id="cb24-16"><a></a>                                       <span class="st">"jenks"</span> <span class="ot">=</span> <span class="st">"jenks"</span>),</span>
<span id="cb24-17"><a></a>                        <span class="at">selected =</span> <span class="st">"pretty"</span>),</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-building-a-choropleth-mapping-application-4">In-class Exercise: Building a choropleth mapping application</h3>
<p>At the UI, continue edit the codes as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>            <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">"classes"</span>,</span>
<span id="cb25-2"><a></a>                        <span class="at">label =</span> <span class="st">"Number of classes"</span>,</span>
<span id="cb25-3"><a></a>                        <span class="at">min =</span> <span class="dv">6</span>,</span>
<span id="cb25-4"><a></a>                        <span class="at">max =</span> <span class="dv">12</span>,</span>
<span id="cb25-5"><a></a>                        <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">6</span>)),</span>
<span id="cb25-6"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"colour"</span>,</span>
<span id="cb25-7"><a></a>                        <span class="at">label =</span> <span class="st">"Colour scheme:"</span>,</span>
<span id="cb25-8"><a></a>                        <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">"blues"</span> <span class="ot">=</span> <span class="st">"Blues"</span>, </span>
<span id="cb25-9"><a></a>                                       <span class="st">"reds"</span> <span class="ot">=</span> <span class="st">"Reds"</span>, </span>
<span id="cb25-10"><a></a>                                       <span class="st">"greens"</span> <span class="ot">=</span> <span class="st">"Greens"</span>,</span>
<span id="cb25-11"><a></a>                                       <span class="st">"Yellow-Orange-Red"</span> <span class="ot">=</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb25-12"><a></a>                                       <span class="st">"Yellow-Orange-Brown"</span> <span class="ot">=</span> <span class="st">"YlOrBr"</span>,</span>
<span id="cb25-13"><a></a>                                       <span class="st">"Yellow-Green"</span> <span class="ot">=</span> <span class="st">"YlGn"</span>,</span>
<span id="cb25-14"><a></a>                                       <span class="st">"Orange-Red"</span> <span class="ot">=</span> <span class="st">"OrRd"</span>),</span>
<span id="cb25-15"><a></a>                        <span class="at">selected =</span> <span class="st">"YlOrRd"</span>)</span>
<span id="cb25-16"><a></a>        <span class="er">)</span>,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="in-class-exercise-building-a-choropleth-mapping-application-5">In-class Exercise: Building a choropleth mapping application</h3>
<p>At the server, edit the codes as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output){</span>
<span id="cb26-2"><a></a>    output<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb26-3"><a></a>        <span class="fu">tm_shape</span>(mpsz_agemale2018)<span class="sc">+</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb26-4"><a></a>            <span class="fu">tm_fill</span>(<span class="st">"DEPENDENCY"</span>,  <span class="co">#&lt;&lt;</span></span>
<span id="cb26-5"><a></a>                    <span class="at">n =</span> input<span class="sc">$</span>classes, <span class="co">#&lt;&lt;</span></span>
<span id="cb26-6"><a></a>                    <span class="at">style =</span> input<span class="sc">$</span>classification, <span class="co">#&lt;&lt;</span></span>
<span id="cb26-7"><a></a>                    <span class="at">palette =</span> input<span class="sc">$</span>colour) <span class="sc">+</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb26-8"><a></a>            <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb26-9"><a></a>                       <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb26-10"><a></a>        })</span>
<span id="cb26-11"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>A gentle reminder,</p>
</div>
</div>
</div>
</section>
<section id="embedding-an-interactive-map-in-shiny" class="slide level2">
<h2>Embedding an interactive map in Shiny</h2>
<p>In this exercise, you will learn how to embed an interactive map in Shiny by using <code>renderTmap()</code> and <code>tmapOutput()</code> of <strong>tmap</strong> package. The interactive map is a proportional symbol map showing distribution of winnings by branches/outlets.</p>

<img data-src="img/image25.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="setting-up-1">Setting up</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb27-2"><a></a><span class="fu">library</span>(sf)</span>
<span id="cb27-3"><a></a><span class="fu">library</span>(tmap)</span>
<span id="cb27-4"><a></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h3 id="importing-the-geospatial-data-1">Importing the geospatial data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>sgpools <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/SGPools_svy21.csv"</span>)</span>
<span id="cb28-2"><a></a>sgpools_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(sgpools, </span>
<span id="cb28-3"><a></a>                       <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"XCOORD"</span>, </span>
<span id="cb28-4"><a></a>                                  <span class="st">"YCOORD"</span>),</span>
<span id="cb28-5"><a></a>                       <span class="at">crs=</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Things to learn from the code chunk above:</strong></p>
</div>
<div class="callout-content">
<ul>
<li><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html"><code>st_as_sf()</code></a> of sf package is used to convert the tibble data frame into simple feature data frame by using values from the XCOORD and YCOORD fields. The crs argument is used to specify the projected coordinates systems (i.e.&nbsp;svy21 for Singapore).</li>
</ul>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="the-ui-1">The ui</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb29-2"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Interactive Map View"</span>),</span>
<span id="cb29-3"><a></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb29-4"><a></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb29-5"><a></a>            <span class="fu">checkboxInput</span>(<span class="at">inputId =</span> <span class="st">"showData"</span>,</span>
<span id="cb29-6"><a></a>                          <span class="at">label =</span> <span class="st">"Show data table"</span>,</span>
<span id="cb29-7"><a></a>                          <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-8"><a></a>        ),</span>
<span id="cb29-9"><a></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb29-10"><a></a>            <span class="fu">tmapOutput</span>(<span class="st">"mapPlot"</span>), <span class="co">#&lt;&lt;</span></span>
<span id="cb29-11"><a></a>            DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="at">outputId =</span> <span class="st">"aTable"</span>)</span>
<span id="cb29-12"><a></a>        )</span>
<span id="cb29-13"><a></a>    )</span>
<span id="cb29-14"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Notice that <code>tmapout()</code> is used instead of <code>plotOutput()</code>.</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="the-server-1">The server</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session){</span>
<span id="cb30-2"><a></a>    output<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="fu">renderTmap</span>({   <span class="co">#&lt;&lt;</span></span>
<span id="cb30-3"><a></a>        <span class="fu">tm_shape</span>(sgpools_sf)<span class="sc">+</span></span>
<span id="cb30-4"><a></a>            <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"OUTLET TYPE"</span>,</span>
<span id="cb30-5"><a></a>                       <span class="at">size =</span> <span class="st">"Gp1Gp2 Winnings"</span>,</span>
<span id="cb30-6"><a></a>                       <span class="at">border.col =</span> <span class="st">"black"</span>,</span>
<span id="cb30-7"><a></a>                       <span class="at">border.lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-8"><a></a>    })</span>
<span id="cb30-9"><a></a>    </span>
<span id="cb30-10"><a></a>    output<span class="sc">$</span>aTable <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb30-11"><a></a>        <span class="cf">if</span>(input<span class="sc">$</span>showData){</span>
<span id="cb30-12"><a></a>            DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">data =</span> sgpools_sf <span class="sc">%&gt;%</span> </span>
<span id="cb30-13"><a></a>                            <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb30-14"><a></a>                          <span class="at">options=</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb30-15"><a></a>                          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-16"><a></a>        }</span>
<span id="cb30-17"><a></a>    })    </span>
<span id="cb30-18"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Notice that <a href="https://rdrr.io/cran/tmap/man/renderTmap.html"><code>renderTmap()</code></a> is used instead of <code>renderPlot()</code>.</p>
</div>
</div>
</div>
</section>
<section id="in-class-exercise-reactive-map-in-r-shiny" class="slide level2">
<h2>In-class Exercise: Reactive Map in R Shiny</h2>
<p>In this exercise, you will learn how to create reactive map in Shiny. The output will look similar to the figure below.</p>

<img data-src="img/image26.jpg" class="r-stretch"></section>
<section class="slide level2">

<h3 id="the-ui-2">The ui</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb31-2"><a></a>    <span class="fu">titlePanel</span>(<span class="st">"Reactive Map"</span>),</span>
<span id="cb31-3"><a></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb31-4"><a></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb31-5"><a></a>            <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">"type"</span>,</span>
<span id="cb31-6"><a></a>                        <span class="at">label =</span> <span class="st">"Branch or Outlet?"</span>,</span>
<span id="cb31-7"><a></a>                        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"branch"</span> <span class="ot">=</span> <span class="st">"Branch"</span>,</span>
<span id="cb31-8"><a></a>                                    <span class="st">"outlet"</span> <span class="ot">=</span> <span class="st">"Outlet"</span>),</span>
<span id="cb31-9"><a></a>                        <span class="at">selected =</span> <span class="st">"Branch"</span>,</span>
<span id="cb31-10"><a></a>                        <span class="at">multiple =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-11"><a></a>            <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">"winning"</span>, </span>
<span id="cb31-12"><a></a>                        <span class="at">label =</span> <span class="st">"Number of winnings"</span>, </span>
<span id="cb31-13"><a></a>                        <span class="at">min =</span> <span class="dv">2</span>,</span>
<span id="cb31-14"><a></a>                        <span class="at">max =</span> <span class="dv">80</span>, </span>
<span id="cb31-15"><a></a>                        <span class="at">value =</span> <span class="dv">20</span>),</span>
<span id="cb31-16"><a></a>            <span class="fu">checkboxInput</span>(<span class="at">inputId =</span> <span class="st">"showData"</span>,</span>
<span id="cb31-17"><a></a>                          <span class="at">label =</span> <span class="st">"Show data table"</span>,</span>
<span id="cb31-18"><a></a>                          <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-19"><a></a>        ),</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="the-ui-continue">The ui (continue)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb32-2"><a></a>            <span class="fu">tmapOutput</span>(<span class="st">"mapPlot"</span>),</span>
<span id="cb32-3"><a></a>            DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="at">outputId =</span> <span class="st">"aTable"</span>)</span>
<span id="cb32-4"><a></a>        )</span>
<span id="cb32-5"><a></a>    <span class="er">)</span></span>
<span id="cb32-6"><a></a><span class="er">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="the-server-2">The server</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session){</span>
<span id="cb33-2"><a></a>    dataset <span class="ot">=</span> <span class="fu">reactive</span>({ <span class="co">#&lt;&lt;                   </span></span>
<span id="cb33-3"><a></a>        sgpools_sf <span class="sc">%&gt;%</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb33-4"><a></a>            <span class="fu">filter</span>(TYPE <span class="sc">==</span> input<span class="sc">$</span>type) <span class="sc">%&gt;%</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb33-5"><a></a>            <span class="fu">filter</span>(WINNINGS <span class="sc">&gt;</span> input<span class="sc">$</span>winning) <span class="co">#&lt;&lt;</span></span>
<span id="cb33-6"><a></a>    })</span>
<span id="cb33-7"><a></a>    </span>
<span id="cb33-8"><a></a>    output<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="fu">renderTmap</span>({</span>
<span id="cb33-9"><a></a>        <span class="fu">tm_shape</span>(<span class="at">shp =</span> <span class="fu">dataset</span>(), <span class="co">#&lt;&lt;</span></span>
<span id="cb33-10"><a></a>                 <span class="at">bbox =</span> <span class="fu">st_bbox</span>(sgpools_sf))<span class="sc">+</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb33-11"><a></a>            <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"TYPE"</span>,</span>
<span id="cb33-12"><a></a>                       <span class="at">size =</span> <span class="st">"WINNINGS"</span>,</span>
<span id="cb33-13"><a></a>                       <span class="at">border.col =</span> <span class="st">"black"</span>,</span>
<span id="cb33-14"><a></a>                       <span class="at">border.lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb33-15"><a></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Things to learn from the code chunk above:</strong></p>
</div>
<div class="callout-content">
<ul>
<li><a href="https://shiny.rstudio.com/reference/shiny/1.6.0/reactive.html"><code>reactive()</code></a> is used to create a reactive expression (i.e.&nbsp;dataset) that hold the extracted data set.</li>
<li><em>bbox = <code>st_bbox()</code></em> argument is used to fix the extend of the map view.</li>
</ul>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="the-server-continue">The server (continue)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>    output<span class="sc">$</span>aTable <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb34-2"><a></a>        <span class="cf">if</span>(input<span class="sc">$</span>showData){</span>
<span id="cb34-3"><a></a>            DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">data =</span> <span class="fu">dataset</span>() <span class="sc">%&gt;%</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb34-4"><a></a>                              <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb34-5"><a></a>                          <span class="at">options=</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb34-6"><a></a>                          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-7"><a></a>        }</span>
<span id="cb34-8"><a></a>    })    </span>
<span id="cb34-9"><a></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Also, don’t forget this magic line!</p>
</div>
</div>
</div>
</section>
<section id="references" class="slide level2">
<h2>References</h2>
<ul>
<li>Hadley Wickham (2020) <strong>Mastering Shiny: Build Interactive Apps, Reports, and Dashboards Powered by R</strong> online version
<ul>
<li><a href="https://mastering-shiny.org/basic-reactivity.html">Chapter 3 Basic reactivity</a></li>
<li><a href="https://mastering-shiny.org/reactive-motivation.html">Chapter 13 Why reactivity?</a></li>
<li><a href="https://mastering-shiny.org/reactive-graph.html">Chapter 14 The reactive graph</a></li>
<li><a href="https://mastering-shiny.org/reactivity-objects.html">Chapter 15 Reactive building blocks</a></li>
<li><a href="https://mastering-shiny.org/reactivity-components.html">Chapter 16 Escaping the graph</a></li>
</ul></li>
<li>Carson Sievert (2019) <strong>Interactive web-based data visualization with R, plotly, and shiny</strong>, online version.
<ul>
<li><a href="https://plotly-r.com/linking-views-with-shiny.html">Chapter 17 Server-side linking with shiny</a>.</li>
</ul></li>
</ul>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>